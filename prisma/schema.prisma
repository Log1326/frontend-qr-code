// Подключение к базе данных PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Генератор Prisma-клиента
generator client {
  provider = "prisma-client-js"
}

// Основная модель: заказ, оформляемый через QR-форму
model Recipe {
  id          String         @id @default(uuid())         // Уникальный ID заказа
  employee    Employee       @relation(fields: [employeeId], references: [id])
  employeeId  String
  clientName  String         @default("Unknown")          // Имя клиента
  price       Float                                        // Цена заказа
  status      RecipeStatus   @default(NEW)                // Текущий статус заказа
  parameters  Parameter[]                                // Поля формы (описание, фото и т.д.)
  events      RecipeEvent[]                              // История действий над заказом
  position    Int            @default(0)                  // Позиция в колонке (Kanban)
  qrCodeUrl   String?                                    // URL на сохранённый QR-код (если есть)
  createdAt   DateTime       @default(now())              // Время создания заказа
  @@unique([status, position]) // Уникальная позиция в рамках одной колонки
}
// Возможные статусы заказа
enum RecipeStatus {
  NEW           // Новый
  IN_PROGRESS   // В процессе выполнения
  COMPLETED     // Завершён
}
// Поля формы заказа (текст, фото и т.д.)
model Parameter {
  id        String     @id @default(uuid())               // Уникальный ID параметра
  name      String                                        // Название поля (например, "Описание")
  type      FieldType                                     // Тип поля: текст, фото и т.п.
  description String @default("Описание по умолчанию")                                     // Значение (текст или URL)
  order     Int                                           // Порядок отображения
  recipe    Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  recipeId  String                                        // ID связанного заказа
}
// Типы данных, которые могут быть в параметрах формы
enum FieldType {
  TEXT       // Однострочное текстовое поле
  AREA       // Многострочное текстовое поле
  FILE       // Файл (изображение и т.д.)
}
// События над заказом: просмотр, изменение, смена статуса
model RecipeEvent {
  id        String       @id @default(uuid())             // Уникальный ID события
  type      EventType                         // Тип события
  recipe    Recipe       @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  recipeId  String                                        // ID связанного заказа
  createdAt DateTime     @default(now())                  // Время события
}
// События, фиксируемые в системе
enum EventType {
  CREATED         // Заказ создан
  VIEWED          // Заказ просмотрен в админке
  STATUS_CHANGE   // Статус изменён
  UPDATED         // Заказ отредактирован
}

model Employee {
  id        String    @id @default(uuid())         // Уникальный ID сотрудника
  name      String                                // Имя сотрудника
  avatarUrl String?                               // URL к аватару (опционально)
  recipes   Recipe[]                              // Заказы, оформленные этим сотрудником
  createdAt DateTime  @default(now())             // Время создания записи
}
